<!DOCTYPE html>
<html lang="pt_br">
<head>
	<meta charset="utf-8">
    <!-- <meta http-equiv="cache-control" content="no-cache" /> -->
    <meta http-equiv="cache-control" content="max-age=86400, must-revalidate" />
    <meta name="author" content="Fernando L B Pinto" />
    <title>DFH Noc</title>
    <!-- plugins:css -->
	<link rel="shortcut icon" href="Public/Imagens/favicon.png" />
	<script type="text/javascript" src="Public/js/ctadm.js"></script>
    <script type="text/javascript" src="Public/js/ctadmgp.js"></script>
	<script type="text/javascript" src="Public/js/geral.js"></script>
    <script type="text/javascript" src="Public/js/s3.js"></script>
    <link rel="stylesheet" href="Public/css/style.css">
	<link rel="stylesheet" href="Public/css/main.css">
	<link rel="stylesheet" href="Public/css/style_a.css">
    <link rel="stylesheet" href="Public/css/table.css">
    <script src="https://kit.fontawesome.com/ddc0eccd46.js" crossorigin="anonymous"></script>
    <script type="text/javascript" src="Public/js/xlsx.full.min.js"></script>
	<script type="text/javascript" src="https://d3js.org/d3.v6.min.js"></script>

    <!-- Antigod
	<link rel="stylesheet" href="Public/css/style_a.css">
    <link rel="stylesheet" href="Public/css/table.css">

    -->

    <!-- Bootstrap -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.min.js" integrity="sha512-WW8/jxkELe2CAiE4LvQfwm1rajOS8PHasCCx+knHG0gBHt8EXxS6T6tJRTGuDQVnluuAvMxWF4j8SNFDKceLFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" integrity="sha512-b2QcS5SsA8tZodcDtGRELiGv5SaKSk1vDHDaQRda0htPYWZ6046lr3kJ5bAAQdpV2mmA/4v0wQF9MyU6/pDIAg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!--  JQuery
    antigo:
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous"></script>
    -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript">
        if(typeof jQuery === 'undefined'){
              console.log('no jQuery');
                var head = document.getElementsByTagName('head')[0];
                var script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = '../Public/js/jquery.min.js';
                script.onload = handler;
                head.appendChild(script);
            }else{console.log('jQuery is embedded!');}
    function handler(){ console.log('jquery added :)'); }
    </script>
    <!--  Cookies
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" integrity="sha512-3j3VU6WC5rPQB4Ld1jnLV7Kd5xr+cq9avvhwqzbH/taCRNURoeEpoPBK9pDyeukwSxwRPJ8fDgvYXd6SkaZ2TA==" crossorigin="anonymous"></script>  -->
    <script type="text/javascript" src="Public/js/jquery.cookie.min.js" ></script>
    <script type="text/javascript" src="Public/js/jquery.mask.min.js" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>

    <!-- JQuery  Final -->

    <!--  Leitura Arquivo configuração -->
    <script type="text/javascript" src="local/conf.json"></script>
    <script type="text/javascript">
        var host = 'http://127.0.0.1:8000';
        var sdw_ambiente = "DEV";
        var sdw_owner = "DFH";
        if (conf) { var config = JSON.parse(conf); }
        if (config) {
            host = config[0].server;
            sdw_ambiente = config[0].ambiente ;
            sdw_owner = config[0].HEAD;
           }
        console.log("Ambiente : " + sdw_ambiente + " | Owner : " + sdw_owner +  " | Server : "+ host);
    </script>

</head>
<body onload="loadWindow()">

<nav class="nav_dfh" id="nav_dfh" style="display: flex; ">
    <div style="width: 180px ; display: inline-block; padding: 1px ;">
            <a class="logo_dfh" href="http://dfhnegocios.com.br/"> <img src="Public/Imagens/DHF_logo.png" alt="logo"/></a>
    </div>
    <div style="width: 480px; display: inline-block;">
            <p style="font-size: 24px;" > Portal SD WAN - NOC </p>
    </div>


    <!-- Menu Principal -->
    <div class="menu_top" style="font-size: 14px;">
        <ul>
            <li><a href="../close.html">Sair</a></li>
            <li>
                <a onclick="fnConsole()">Console</a>
            </li>
        </ul>
    </div>
    <br>

</nav>

<div class="block_big" >
    <form>
    <fieldset>
        <p> NOC - Console de Incidentes </p>

        <label style = "width: 80px" for="INC_Status" >Status</label><input style = "width: 160px" class="field" id="INC_Status" type="text" maxlength="16">
                        <select name="sel_INC_Status" id="sel_INC_Status" style="width: 20px">
                            <option value=""> Selecionar</option>
                            <option value="Novo">Novo</option>
                            <option value="Em Andamento">Em Andamento</option>
                            <option value="Pendente">Pendente</option>
                            <option value="Cancelado"> Cancelado</option>
                            <option value="Concluido"> Ativo</option>
                        </select>


        <div style = "height: 32px ">
            <input class="button buttonS1" style="float: right; color: white;" type="button" value="Pesquisar" onclick="fnIncidentes('SELECT')">
        </div>
        <br>
        <div style =" height: 400px" >

            <div id="Mytable_Incidentes" class="table table-striped table-bordered table-sm" style = "overflow-y:scroll; width: 100%"></div>
        </div>
        <br>


    </fieldset>
    </form>
</div>





    <div hidden>
            <div><label style = "width: 40px" for="user_Login">Login</label></div>
            <div><input style = "width: 80px"  class="field" id="user_Login" type="text" readonly></div>
            <div><label style = "width: 40px" for="user_Nome" >Nome</label></div>
            <div><input style = "width: 220px" class="field" id="user_Nome" type="text" readonly> </div>
            <div><label style = "width: 60px" for="user_Empresa">Empresa</label></div>
            <div><input style = "width: 120px" class="field" id="user_Empresa" type="text" readonly></div>
    </div>
</body>
</html>

<script type="text/javascript">
  var tkd_Empresa ;
  var tkd_Login ;
  var tkd_TKN ;
  var query_ID ;
  var list_CompMes
  var list_Clientes

function loadWindow() {
    loadSession(tkd_Empresa);

    document.getElementById('INC_Status').value = 'Novo';


    fnIncidentes('SELECT')



}
document.getElementById("sel_INC_Status").addEventListener("change", function () {
    var val = document.getElementById('sel_INC_Status').value;
    if (val != null) {
            document.getElementById('INC_Status').value = val
    }
    else{document.getElementById('INC_Status').value = ''}
});





function fnIncidentes(OP) {
    var CTN_Login = tkd_Login;
    var Status = document.getElementById('INC_Status').value;

    var jsdata = {"tkd_Empresa ": tkd_Empresa , "tkd_Login": CTN_Login };
    var JdataS = JSON.stringify(jsdata)
    var jdata = JSON.parse(JdataS);

    const header = document.querySelector('header');
    const section = document.querySelector('section');
    let headers = new Headers();
    headers.append('Content-Type', 'application/json');
    headers.append('Accept', 'application/json');
    headers.append('Access-Control-Allow-Origin', '*');
    headers.append('Access-Control-Allow-Credentials', 'true');
    headers.append('GET', 'POST', 'OPTIONS');
    headers.append('Upgrade-Insecure-Requests', '1');
    headers.append('Content-Security-Policy', 'upgrade-insecure-requests');

    let Query = '&Status='+Status

    if (OP === 'SELECT') {
        var requestURL = host + '/Incidentes/M?' + Query;
        console.log(requestURL);
        var request = new XMLHttpRequest();
        var request = new XMLHttpRequest();
        request.open('GET', requestURL, true);
        request.responseType = 'json';
        request.send(JSON.stringify(jdata));

        request.onload = function () {
            var resp_post = request.response;
            console.log(resp_post);
            // Trata Resposta
            var status = request.status;
            if (status != 200) {
                alert("Erro  : " + status.toString());
            } else {
                fnAtualizaLista(resp_post);
            }
        }

    }

}


function fnAtualizaLista(jsonObj) {
        var lugares = jsonObj;
        //console.log(lugares);

        while (Mytable_Incidentes.hasChildNodes()) {
            Mytable_Incidentes.removeChild(Mytable_Incidentes.lastChild);
        }
        var mybody = document.getElementsByTagName("Mytable_Incidentes")[0];
        mytablebody = document.createElement("tbody");

        t_colunas = [" ","Ticket","Abertura","Designacao","INC","Ponto","Solicitante","Contato","Cliente","Provedor","Tratamento","Fechamento","Motivo","D","H","Status"];
        mythead = document.createElement("thead");
        myheader = document.createElement("tr");

        var zcol_count = t_colunas.length;
        for (var zcol = 0; zcol < zcol_count; zcol++) {
            mycurrent_header = document.createElement("th");
            mycurrent_header.setAttribute("style", "background-color: white; font-size: 12px ; color:  darksalmon;");
            currentheader = document.createTextNode(t_colunas[zcol]);
            mycurrent_header.appendChild(currentheader);
            myheader.appendChild(mycurrent_header);
        }
        mythead.appendChild(myheader);

        // --- Corpo  da tabela  NocIncidente.html?INC_ID=15
        a_url = "NocIncidente.html?INC_ID="
        mytablebody.appendChild(myheader);
        for (var g_i = 0; g_i < lugares.length; g_i++) {
            mycurrent_row = document.createElement("tr");

            mycurrent_cell = document.createElement("td");
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 12px; color:cadetblue ;width: 6%");
            var btn_ID = lugares[g_i].INC_ID;
            //currenttext = document.createTextNode(btn_ID);
            currenttext = document.createTextNode('');
            mycurrent_cell.setAttribute("ID", 'btn_' + (btn_ID))
            var click = 'fnOpen_Incidente(' + btn_ID + ')';
            mycurrent_cell.setAttribute("onclick", click);
            mycurrent_cell.setAttribute("class", "fas fa-play");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].INCIDENTE;
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].INC_DataAbertura;
            conteudo = EpochToDateList(conteudo, "DT");
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word;font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].INC_Designacao;
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].INC_Ticket;
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].INC_PontoNome;
            if (conteudo != null) {
                conteudo = conteudo.substring(0, 40)
            } else {
                conteudo = ""
            }
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].INC_SolEmpresa;
            if (conteudo) {
                conteudo = conteudo.trim()
            } else {
                conteudo = ""
            }
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].INC_SolContato;
            if (conteudo) {
                conteudo = conteudo.trim()
            } else {
                conteudo = ""
            }
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].clienteNome;
            // if (conteudo) { conteudo = conteudo.trim() } else { conteudo = "" }
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].Provedor;
            if (conteudo != null) {
                conteudo = conteudo.substring(0, 40)
            } else {
                conteudo = ""
            }
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].INC_ProvSituacao;
            if (conteudo != null) {
                conteudo = conteudo.substring(0, 40)
            } else {
                conteudo = ""
            }
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].INC_DataFechamento;
            conteudo = EpochToDateList(conteudo, "DT");
            //if (conteudo != null) { conteudo = conteudo.substring(0, 40) } else { conteudo = "" }
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].INC_Motivo;
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);


            let tchar = ''
            let CriadoData = lugares[g_i].INC_DataAbertura;
            let tempo = 0 ;
            if ( lugares[g_i].INC_DataFechamento  ) {
                let DataFechamento = lugares[g_i].INC_DataFechamento;
                tempo = DataFechamento - CriadoData;
            }
            else {
                let timestamp = new Date()
                timestamp = Date.now();
                tempo = timestamp - CriadoData;
            }
            let totalSeconds = parseInt(Math.floor(tempo / 1000), 10);
            let totalMinutes = parseInt(Math.floor(totalSeconds / 60), 10);
            let totalHours = parseInt(Math.floor(totalMinutes / 60), 10);
            let days = parseInt(Math.floor(totalHours / 24), 10);
            let seconds = parseInt(totalSeconds % 60, 10);
            let minutes = parseInt(totalMinutes % 60, 10);
            let hours = parseInt(totalHours % 24, 10);
            if (minutes < 10 ){minutes = '0'+ minutes }
            tchar = totalHours + ":" + minutes;

            mycurrent_cell = document.createElement("td");
            currenttext = document.createTextNode(days);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; text-align:right ;font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            currenttext = document.createTextNode(tchar);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; text-align:right ;font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

            mycurrent_cell = document.createElement("td");
            conteudo = lugares[g_i].INC_Status;
            currenttext = document.createTextNode(conteudo);
            mycurrent_cell.setAttribute("style", "word-wrap: break-word; text-align:center; font-size: 10px; width: 10%");
            mycurrent_cell.appendChild(currenttext);
            mycurrent_row.appendChild(mycurrent_cell);

        mytablebody.appendChild(mycurrent_row);
        }
    // Linha final
    mycurrent_row = document.createElement("tr");

        mycurrent_cell = document.createElement("td");
        mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 12px; width: 2%");
        mycurrent_row.appendChild(mycurrent_cell);

        mycurrent_cell = document.createElement("td");
        total = lugares.length;
        conteudo = "Total de Links :  " + total;
        currenttext = document.createTextNode(conteudo);
        mycurrent_cell.setAttribute("style", "word-wrap: break-word; font-size: 12px; color: #9926b0; width: 2%;");
        mycurrent_cell.appendChild(currenttext);
        mycurrent_row.appendChild(mycurrent_cell);

        mytablebody.appendChild(mycurrent_row);

    Mytable_Incidentes.appendChild(mytablebody);
}


function fnOpen_Incidente(w_id){
    //console.log(w_id);
    var URL = 'NocIncidente.html?INC_ID='+w_id;
    window.open( URL , "_blank");
}










</script>
